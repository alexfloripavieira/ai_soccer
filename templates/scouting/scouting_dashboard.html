{% extends 'dashboard/base_dashboard.html' %}

{% block title %}Dashboard de Scouting - AI Soccer{% endblock %}

{% block page_title %}Dashboard de Scouting{% endblock %}

{% block dashboard_content %}
<div class="space-y-6">
  <div class="flex flex-col gap-2">
    <h2 class="text-3xl font-bold text-slate-100">Visão geral do scouting</h2>
    <p class="text-sm text-slate-400">
      Acompanhe métricas estratégicas, status do pipeline de talentos e recomendações prioritárias.
    </p>
  </div>

  <div class="grid gap-4 md:grid-cols-2 xl:grid-cols-4">
    <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-5 shadow-lg shadow-slate-950/40">
      <span class="text-xs uppercase tracking-wide text-slate-500">Jogadores monitorados</span>
      <p class="mt-3 text-3xl font-bold text-white">{{ total_players }}</p>
      <p class="mt-1 text-xs text-slate-400">
        Número total de atletas acompanhados pela equipe de scouting.
      </p>
    </div>
    <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-5 shadow-lg shadow-slate-950/40">
      <span class="text-xs uppercase tracking-wide text-slate-500">Relatórios registrados</span>
      <p class="mt-3 text-3xl font-bold text-white">{{ total_reports }}</p>
      <p class="mt-1 text-xs text-slate-400">
        Total de relatórios de observação consolidados no sistema.
      </p>
    </div>
    <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-5 shadow-lg shadow-slate-950/40">
      <span class="text-xs uppercase tracking-wide text-slate-500">Observadores ativos</span>
      <p class="mt-3 text-3xl font-bold text-white">{{ active_scouts }}</p>
      <p class="mt-1 text-xs text-slate-400">
        Scouts que contribuíram com relatórios no período analisado.
      </p>
    </div>
    <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-5 shadow-lg shadow-slate-950/40">
      <span class="text-xs uppercase tracking-wide text-slate-500">Eficiência do pipeline</span>
      <p class="mt-3 text-3xl font-bold text-white">{{ pipeline_efficiency|floatformat:1 }}%</p>
      <p class="mt-1 text-xs text-slate-400">
        Proporção de atletas em fase ativa de negociação dentro do pipeline.
      </p>
    </div>
  </div>

  <div class="grid gap-6 lg:grid-cols-3">
    <div class="lg:col-span-2 rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-lg shadow-slate-950/40">
      <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
        <div>
          <h3 class="text-lg font-semibold text-slate-100">Distribuição por status</h3>
          <p class="text-sm text-slate-400">Entenda em que etapa do pipeline cada atleta se encontra.</p>
        </div>
        <a href="{% url 'scouting:player_list' %}"
           class="inline-flex items-center gap-2 text-sm font-semibold text-blue-300 hover:text-blue-200">
          Gerenciar jogadores
        </a>
      </div>
      <div class="mt-6 grid gap-6 lg:grid-cols-2">
        <div>
          <canvas id="scouting-status-chart" class="h-56"></canvas>
        </div>
        <div class="space-y-4">
          {% for item in status_distribution %}
            <div>
              <div class="flex items-center justify-between text-sm">
                <span class="font-semibold text-slate-200">{{ item.label }}</span>
                <span class="text-slate-400">{{ item.count }} · {{ item.percentage|floatformat:1 }}%</span>
              </div>
              <div class="mt-2 h-2 w-full rounded-full bg-slate-800">
                <div class="h-2 rounded-full bg-gradient-to-r from-green-500 to-blue-500" style="width: {{ item.percentage|floatformat:0 }}%; max-width: 100%;"></div>
              </div>
            </div>
          {% empty %}
            <p class="text-sm text-slate-500">Nenhum jogador cadastrado até o momento.</p>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-lg shadow-slate-950/40">
      <h3 class="text-lg font-semibold text-slate-100">Últimos relatórios</h3>
      <p class="text-sm text-slate-400">Atualizações recentes da equipe e insights capturados em campo.</p>
      <div class="mt-4 space-y-4">
        {% if has_reports %}
          {% for report in latest_reports %}
            <a href="{% url 'scouting:report_detail' report.pk %}"
               class="block rounded-xl border border-slate-800 bg-slate-900/70 p-4 transition-colors duration-150 hover:border-slate-600">
              <div class="flex items-center justify-between">
                <span class="text-sm font-semibold text-slate-100">{{ report.player.name }}</span>
                <span class="text-xs text-slate-400">{{ report.report_date|date:"d/m" }}</span>
              </div>
              <p class="mt-1 text-xs text-slate-400">{{ report.match_or_event }}</p>
              <div class="mt-3 inline-flex items-center gap-2 rounded-full border border-green-500/40 bg-green-500/10 px-3 py-1 text-xs font-semibold text-green-300">
                Overall {{ report.overall_score|floatformat:1 }}
              </div>
            </a>
          {% endfor %}
        {% else %}
          <div class="rounded-xl border border-dashed border-slate-700 bg-slate-900/60 p-6 text-center">
            <p class="text-sm text-slate-400">Nenhum relatório foi registrado ainda.</p>
            <a href="{% url 'scouting:report_create' %}"
               class="mt-3 inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-green-500 to-blue-500 px-4 py-2 text-xs font-semibold text-white shadow-lg shadow-green-900/40">
              Criar primeiro relatório
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="grid gap-6 lg:grid-cols-2">
    <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-lg shadow-slate-950/40">
      <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
        <div>
          <h3 class="text-lg font-semibold text-slate-100">Top 5 jogadores por overall</h3>
          <p class="text-sm text-slate-400">Ranking baseado na média dos relatórios registrados.</p>
        </div>
        <a href="{% url 'scouting:report_list' %}"
           class="inline-flex items-center gap-2 text-sm font-semibold text-blue-300 hover:text-blue-200">
          Ver relatórios
        </a>
      </div>
      <div class="mt-4 space-y-4">
        {% for player in top_players %}
          <div class="rounded-xl border border-slate-800 bg-slate-900/70 p-4">
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
              <div>
                <p class="text-sm font-semibold text-slate-100">{{ player.name }}</p>
                <p class="text-xs text-slate-400">{{ player.get_position_display }} · {{ player.nationality }}</p>
              </div>
              <div class="flex items-center gap-3">
                <span class="text-sm font-semibold text-green-300">{{ player.overall_avg|floatformat:1 }}</span>
                <span class="text-xs text-slate-500">{{ player.report_count }} relatórios</span>
              </div>
            </div>
            <div class="mt-3 h-2 w-full rounded-full bg-slate-800">
              <div class="h-2 rounded-full bg-gradient-to-r from-green-500 to-blue-500" style="width: {{ player.overall_percentage|floatformat:0 }}%; max-width: 100%;"></div>
            </div>
            <div class="mt-3 flex gap-2">
              <a href="{% url 'scouting:player_detail' player.pk %}"
                 class="inline-flex items-center gap-2 rounded-lg border border-slate-700 px-3 py-2 text-xs font-semibold text-slate-200 transition-all duration-150 hover:border-slate-500 hover:text-white">
                Ver perfil
              </a>
              <a href="{% url 'scouting:report_create' %}?player={{ player.pk }}"
                 class="inline-flex items-center gap-2 rounded-lg border border-slate-700 px-3 py-2 text-xs font-semibold text-slate-200 transition-all duration-150 hover:border-slate-500 hover:text-white">
                Novo relatório
              </a>
            </div>
          </div>
        {% empty %}
          <p class="text-sm text-slate-500">Ainda não há dados suficientes para gerar o ranking.</p>
        {% endfor %}
      </div>
    </div>

    <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-lg shadow-slate-950/40">
      <h3 class="text-lg font-semibold text-slate-100">Recomendações prioritárias</h3>
      <p class="text-sm text-slate-400">Atletas com alto potencial que merecem atenção imediata da equipe.</p>
      <div class="mt-4 space-y-4">
        {% for player in priority_players %}
          <div class="rounded-xl border border-amber-400/30 bg-amber-500/10 p-4">
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
              <div>
                <p class="text-sm font-semibold text-amber-200">{{ player.name }}</p>
                <p class="text-xs text-amber-100/80">{{ player.get_position_display }} · {{ player.current_club|default:'Sem clube' }}</p>
              </div>
              <div class="flex items-center gap-3">
                <span class="inline-flex items-center gap-1 rounded-full border border-amber-300/40 bg-amber-400/15 px-3 py-1 text-xs font-semibold text-amber-200">
                  Potencial {{ player.potential_avg_value|floatformat:1 }}
                </span>
                <span class="inline-flex items-center gap-1 rounded-full border border-green-300/40 bg-green-400/10 px-3 py-1 text-xs font-semibold text-green-200">
                  Overall {{ player.overall_avg|floatformat:1 }}
                </span>
              </div>
            </div>
            <div class="mt-3 flex flex-wrap gap-2">
              <a href="{% url 'scouting:player_detail' player.pk %}"
                 class="inline-flex items-center gap-2 rounded-lg border border-amber-300/40 px-3 py-2 text-xs font-semibold text-amber-100 transition-all duration-150 hover:border-amber-200 hover:text-amber-50">
                Abrir perfil
              </a>
              <a href="{% url 'scouting:report_create' %}?player={{ player.pk }}"
                 class="inline-flex items-center gap-2 rounded-lg border border-amber-300/40 px-3 py-2 text-xs font-semibold text-amber-100 transition-all duration-150 hover:border-amber-200 hover:text-amber-50">
                Atualizar relatório
              </a>
            </div>
          </div>
        {% empty %}
          <div class="rounded-xl border border-dashed border-amber-400/40 bg-amber-500/5 p-6 text-center">
            <p class="text-sm text-amber-100">Nenhum jogador prioritário identificado no momento.</p>
            <p class="mt-2 text-xs text-amber-200/80">Cadastre novos relatórios para atualizar a priorização.</p>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
{% if status_values %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js" integrity="sha384-1V8YIfJfnS417hKjFY6pFIheN4mqCpKZXDN9icuYxcDRr1IAdZjAWeA9d7FpC18m" crossorigin="anonymous"></script>
<script>
  (function() {
    const canvas = document.getElementById('scouting-status-chart');
    if (!canvas) {
      return;
    }
    const dataLabels = {{ status_labels|safe }};
    const dataValues = {{ status_values|safe }};
    new window.Chart(canvas, {
      type: 'doughnut',
      data: {
        labels: dataLabels,
        datasets: [{
          data: dataValues,
          backgroundColor: [
            'rgba(59, 130, 246, 0.7)',
            'rgba(250, 204, 21, 0.7)',
            'rgba(16, 185, 129, 0.7)'
          ],
          borderColor: [
            'rgba(59, 130, 246, 1)',
            'rgba(250, 204, 21, 1)',
            'rgba(16, 185, 129, 1)'
          ],
          borderWidth: 1,
          hoverOffset: 4,
        }],
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: '#e2e8f0',
            },
          },
        },
      },
    });
  })();
</script>
{% endif %}
{% endblock %}
